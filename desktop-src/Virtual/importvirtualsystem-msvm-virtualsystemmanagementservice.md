---
title: ImportVirtualSystem method of the Msvm\_VirtualSystemManagementService class
description: Imports a virtual computer system definition from file.
ms.assetid: 868a704b-f970-44b9-8396-78161057859d
keywords:
- ImportVirtualSystem method Hyper-V
- ImportVirtualSystem method Hyper-V , Msvm_VirtualSystemManagementService class
- Msvm_VirtualSystemManagementService class Hyper-V , ImportVirtualSystem method
topic_type:
- apiref
api_name:
- Msvm_VirtualSystemManagementService.ImportVirtualSystem
api_location:
- Root\Virtualization
api_type:
- COM
ms.date: 05/31/2018
ms.topic: article
ms.author: windowssdkdev
ms.prod: windows
ms.technology: desktop
---

# ImportVirtualSystem method of the Msvm\_VirtualSystemManagementService class

Beginning with Windows Server 2008 R2 this method is deprecated. Use the [**ImportVirtualSystemEx**](msvm-virtualsystemmanagementservice-importvirtualsystemex.md) method.

**Windows Server 2008:** Imports a virtual computer system definition from file. The resulting virtual computer system will be in the "Defined" state.

## Syntax


```mof
uint32 ImportVirtualSystem(
  [in]  string              ImportDirectory,
  [in]  boolean             GenerateNewID,
  [out] CIM_ConcreteJob REF Job
);
```



## Parameters

<dl> <dt>

*ImportDirectory* \[in\]
</dt> <dd>

Type: **string**

The fully qualified path to the directory that represents a previously exported virtual computer system. This file must have been generated by a previous call to the [**ExportVirtualSystem**](exportvirtualsystem-msvm-virtualsystemmanagementservice.md) or [**ExportVirtualSystemEx**](msvm-virtualsystemmanagementservice-exportvirtualsystemex.md) methods.

</dd> <dt>

*GenerateNewID* \[in\]
</dt> <dd>

Type: **boolean**

Indicates whether to reuse the unique identifier for the virtual computer system. If this parameter is **TRUE**, it is guaranteed that the identifier will not conflict with the identifier of an existing virtual computer system.

It can be useful to specify **FALSE** to track a specific virtual computer system across an export/import cycle, as the identifier for the virtual computer system will be the same as it was before the export. However, clients must ensure that the unique identifier is not already in use by an existing virtual computer system.

</dd> <dt>

*Job* \[out\]
</dt> <dd>

Type: **CIM\_ConcreteJob**

An optional reference that is returned if the operation is executed asynchronously. If present, the returned reference to an instance of [**CIM\_ConcreteJob**](https://msdn.microsoft.com/library/cc136808) can be used to monitor progress and to obtain the result of the method.

</dd> </dl>

## Return value

Type: **uint32**

If this method is executed synchronously, it returns 0 if it succeeds. If this method is executed asynchronously, it returns 4096 and the *Job* output parameter can be used to track the progress of the asynchronous operation. Any other return value indicates an error.

<dl> <dt>

**Completed with No Error** (0)
</dt> <dt>

**Method Parameters Checked - Job Started** (4096)
</dt> <dt>

**Failed** (32768)
</dt> <dt>

**Access Denied** (32769)
</dt> <dt>

**Not Supported** (32770)
</dt> <dt>

**Status is unknown** (32771)
</dt> <dt>

**Timeout** (32772)
</dt> <dt>

**Invalid parameter** (32773)
</dt> <dt>

**System is in use** (32774)
</dt> <dt>

**Invalid state for this operation** (32775)
</dt> <dt>

**Incorrect data type** (32776)
</dt> <dt>

**System is not available** (32777)
</dt> <dt>

**Out of memory** (32778)
</dt> </dl>

## Remarks

The import directory will not be the same as the export directory specified in [**ExportVirtualSystem**](exportvirtualsystem-msvm-virtualsystemmanagementservice.md). The **ExportVirtualSystem** method creates a new subdirectory to store the virtual computer system data to enable exporting multiple virtual computer systems to the same export directory. This subdirectory must be passed as the *ImportDirectory* parameter to this method.

Access to the [**Msvm\_VirtualSystemManagementService**](msvm-virtualsystemmanagementservice.md) class might be restricted by UAC Filtering. For more information, see [User Account Control and WMI](https://msdn.microsoft.com/library/aa826699).

## Examples

The following C# sample imports a virtual system. The referenced utilities can be found in [Common Utilities for the Virtualization Samples](common-utilities-for-the-virtualization-samples.md).

> \[!Important\]  
> To function correctly, the following code must be run on the VM host server, and must be run with Administrator privileges.

 


```CSharp
using System;
using System.IO;
using System.Management;

namespace HyperVSamples
{
    class ImportVirtualSystemClass
    {
        static void ImportVirtualSystem(string importDirectory, string generateNewID)
        {
            ManagementScope scope = new ManagementScope(@"root\virtualization", null);
            ManagementObject virtualSystemService = Utility.GetServiceObject(scope, "Msvm_VirtualSystemManagementService");

            ManagementBaseObject inParams = virtualSystemService.GetMethodParameters("ImportVirtualSystem");
            inParams["GenerateNewID"] = generateNewID;
            inParams["ImportDirectory"] = importDirectory;

            ManagementBaseObject outParams = virtualSystemService.InvokeMethod("ImportVirtualSystem", inParams, null);

            if ((UInt32)outParams["ReturnValue"] == ReturnCode.Started)
            {
                if (Utility.JobCompleted(outParams, scope))
                {
                    Console.WriteLine("VM were imported successfully.");

                }
                else
                {
                    Console.WriteLine("Failed to import VM");
                }
            }
            else if ((UInt32)outParams["ReturnValue"] == ReturnCode.Completed)
            {
                Console.WriteLine("VM were imported successfully.");
            }
            else
            {
                Console.WriteLine("Import virtual system failed with error {0}", outParams["ReturnValue"]);
            }

            inParams.Dispose();
            outParams.Dispose();
            virtualSystemService.Dispose();
        }

        static void Main(string[] args)
        {
            if (args != null &amp;&amp; args.Length != 2)
            {
                Console.WriteLine("Usage: ImportVirtualSystem importDirectory generateNewID");
                Console.WriteLine("generateNewID:true|false");
                return;
            }
            ImportVirtualSystem(args[0], args[1]);
        }
    }
}
```



The following VBScript sample imports a virtual system.

> \[!Important\]  
> To function correctly, the following code must be run on the VM host server, and must be run with Administrator privileges.

 


```VB
option explicit 

dim objWMIService
dim managementService
dim fileSystem


const JobStarting = 3
const JobRunning = 4
const JobCompleted = 7
const wmiStarted = 4096
const wmiSuccessful = 0

Main()

'-----------------------------------------------------------------
' Main
'-----------------------------------------------------------------
Sub Main()
    dim computer, objArgs, importDirectory, generateNewID
    
    set fileSystem = Wscript.CreateObject("Scripting.FileSystemObject")
    computer = "."
    set objWMIService = GetObject("winmgmts:\\" & computer & "\root\virtualization")
    set managementService = objWMIService.ExecQuery("select * from Msvm_VirtualSystemManagementService").ItemIndex(0)
    
    set objArgs = WScript.Arguments
    if WScript.Arguments.Count = 2 then
        importDirectory = objArgs.Unnamed.Item(0)
        generateNewID = objArgs.Unnamed.Item(1)
    else
        WScript.Echo "usage: cscript ImportVirtualSystem.vbs importDirectoryName generateNewID"
        WScript.Echo "generateNewID:true|false"
        WScript.Quit(1)
    end if
   
    if ImportVirtualSystem(importDirectory, generateNewID) then
        WriteLog "Done"
        WScript.Quit(0)
    else
        WriteLog "importDirectory Failed."
        WScript.Quit(1)
    end if
End Sub


'-----------------------------------------------------------------
' ImportVirtualSystem from a directory
'-----------------------------------------------------------------
Function ImportVirtualSystem(importDirectory, generateNewID)

    dim objInParam, objOutParams
    
    ImportVirtualSystem = false
    set objInParam = managementService.Methods_("ImportVirtualSystem").InParameters.SpawnInstance_()
    objInParam.GenerateNewID = generateNewID
    objInParam.ImportDirectory = importDirectory
    
    set objOutParams = managementService.ExecMethod_("ImportVirtualSystem", objInParam)

    if objOutParams.ReturnValue = wmiStarted then
        if (WMIJobCompleted(objOutParams)) then
            ImportVirtualSystem = true
        end if
    elseif objOutParams.ReturnValue = wmiSuccessful then
        ImportVirtualSystem = true
    else
        WriteLog Format1("ImportVirtualSystem failed with ReturnValue {0}", objOutParams.ReturnValue)
    end if

End Function


'-----------------------------------------------------------------
' Handle wmi Job object
'-----------------------------------------------------------------
Function WMIJobCompleted(outParam)

    dim WMIJob, jobState

    set WMIJob = objWMIService.Get(outParam.Job)

    WMIJobCompleted = true

    jobState = WMIJob.JobState

    while jobState = JobRunning or jobState = JobStarting
        WriteLog Format1("In progress... {0}% completed.",WMIJob.PercentComplete)
        WScript.Sleep(1000)
        set WMIJob = objWMIService.Get(outParam.Job)
        jobState = WMIJob.JobState
    wend

    if (jobState <> JobCompleted) then
        WriteLog Format1("ErrorCode:{0}", WMIJob.ErrorCode)
        WriteLog Format1("ErrorDescription:{0}", WMIJob.ErrorDescription)
        WMIJobCompleted = false
    end if

End Function

'-----------------------------------------------------------------
' Create the console log files.
'-----------------------------------------------------------------
Sub WriteLog(line)
    dim fileStream
    set fileStream = fileSystem.OpenTextFile(".\ImportVirtualSystem.log", 8, true)
    WScript.Echo line
    fileStream.WriteLine line
    fileStream.Close

End Sub

'------------------------------------------------------------------------------
' The string formatting functions to avoid string concatenation.
'------------------------------------------------------------------------------
Function Format1(myString, arg0)
    Format1 = Replace(myString, "{0}", arg0)
End Function
```



## Requirements



|                                     |                                                                                                      |
|-------------------------------------|------------------------------------------------------------------------------------------------------|
| Minimum supported client<br/> | None supported<br/>                                                                            |
| Minimum supported server<br/> | Windows Server 2008<br/>                                                                       |
| End of client support<br/>    | None supported<br/>                                                                            |
| End of server support<br/>    | Windows Server 2012<br/>                                                                       |
| Namespace<br/>                | Root\\Virtualization<br/>                                                                      |
| MOF<br/>                      | <dl> <dt>WindowsVirtualization.mof</dt> </dl> |



## See also

<dl> <dt>

[**Msvm\_VirtualSystemManagementService**](msvm-virtualsystemmanagementservice.md)
</dt> <dt>

[**ImportVirtualSystemEx**](msvm-virtualsystemmanagementservice-importvirtualsystemex.md)
</dt> </dl>

 

 





