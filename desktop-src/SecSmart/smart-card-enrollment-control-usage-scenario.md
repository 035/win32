---
title: Smart Card Enrollment Control Usage Scenario
description: The following scenario illustrates the use of the Smart Card Enrollment control by an administrator issuing smart cards for an organization.
ms.assetid: '2d9a36e3-76fd-4226-bc39-405b7c13a115'
keywords: ["Smart Card Enrollment Control usage scenario Security"]
---

# Smart Card Enrollment Control Usage Scenario

This topic is not current. For the most current information about the Smart Card API, see [Smart Card Minidriver Specification](http://go.microsoft.com/fwlink/p/?linkid=178045).

The following scenario illustrates the use of the Smart Card Enrollment control by an administrator issuing [*smart cards*](https://msdn.microsoft.com/library/windows/desktop/ms721625#-security-smart-card-gly) for an organization. All methods and properties referenced are provided by the Smart Card Enrollment control.

1.  The administrator obtains an enrollment agent certificate (also known as a *signing certificate*). The [*private key*](https://msdn.microsoft.com/library/windows/desktop/ms721603#-security-private-key-gly) associated with this enrollment agent certificate is used to sign a PKCS \#7 request; the PKCS \#7 request, in turn, contains the user's PKCS \#10 request (which is signed with the user's private key).

    The administrator can use the Certificate Manager MMC snap-in to obtain an enrollment agent certificate. Note that although the administrator's enrollment agent certificate will be used to sign the certificate request, the [*certification authority*](https://msdn.microsoft.com/library/windows/desktop/ms721572#-security-certification-authority-gly) (CA) will issue and sign the certificate that is stored on the smart card after enrollment has completed.

2.  The administrator uses a machine which is running the Smart Card Enrollment Control; the machine must contain one or more smart card readers. (If the administrator's enrollment agent certificate is stored on a smart card, the machine must contain two smart card readers: one for reading the administrator's enrollment agent smart card certificate, and one for generating the user's smart card certificate).
3.  The administrator sets the name of a certificate template to be used, by calling the [**setCertTemplateName**](https://msdn.microsoft.com/library/windows/desktop/aa386943) method. An example of a certificate template name is "User". (If the administrator wants to determine the available certificate templates, the [**getCertTemplateCount**](https://msdn.microsoft.com/library/windows/desktop/aa386581) method retrieves the number of available certificate templates, and the [**enumCertTemplateName**](https://msdn.microsoft.com/library/windows/desktop/aa386569) method can be used to enumerate their names).
4.  The administrator sets the name of a CA to be used to issue the certificate. This occurs by calling the [**setCAName**](https://msdn.microsoft.com/library/windows/desktop/aa386942) method. (If the administrator wants to determine the available CAs, the [**getCACount**](https://msdn.microsoft.com/library/windows/desktop/aa386574) method returns the number of available CAs, and the [**enumCAName**](https://msdn.microsoft.com/library/windows/desktop/aa386566) method can be used to enumerate their names).
5.  The administrator sets the name of a [*Cryptographic Service Provider*](https://msdn.microsoft.com/library/windows/desktop/ms721572#-security-cryptographic-service-provider-gly) (CSP) to be used. This occurs by setting the [**CSPName**](https://msdn.microsoft.com/library/windows/desktop/aa386561) property. (If the administrator wants to determine the available CSPs, the [**CSPCount**](https://msdn.microsoft.com/library/windows/desktop/aa386559) property contains the number of available CSPs and the [**enumCSPName**](https://msdn.microsoft.com/library/windows/desktop/aa386572) method can be used to enumerate their names).
6.  The administrator specifies a signing certificate to be used to sign the [*certificate request*](https://msdn.microsoft.com/library/windows/desktop/ms721572#-security-certificate-request-gly). This signing certificate is synonymous with the enrollment agent certificate obtained in Step 1. The [**selectSigningCertificate**](https://msdn.microsoft.com/library/windows/desktop/aa386940) method invokes a [*user interface*](https://msdn.microsoft.com/library/windows/desktop/ms721629#-security-user-interface-smart-card--gly), allowing the administrator to choose the signing certificate. An alternative to using a user interface to select the signing certificate is to call [**setSigningCertificate**](https://msdn.microsoft.com/library/windows/desktop/aa386944). (After a signing certificate has been specified, the [**getSigningCertificateName**](https://msdn.microsoft.com/library/windows/desktop/aa386937) method can be called to retrieve the subject name of the certificate). If the administrator's signing certificate is on a [*smart card*](https://msdn.microsoft.com/library/windows/desktop/ms721625#-security-smart-card-gly), the smart card must be placed in the smart card reader.
7.  The administrator places the user's smart card in the smart card [*reader*](https://msdn.microsoft.com/library/windows/desktop/ms721604#-security-reader-gly). (Note that if the administrator's signing certificate is on a smart card, there would be at least two smart card readers on the machine; one reader would contain the smart card representing the administrator's enrollment agent certificate, and the other would contain the smart card which is to be issued the user certificate).
8.  The administrator specifies the name of the user to be issued the certificate. This can be done in one of two ways. The administrator can invoke the Select User interface by calling the [**selectUserName**](https://msdn.microsoft.com/library/windows/desktop/aa386941) method and choosing the user name, or the administrator can call the [**setUserName**](https://msdn.microsoft.com/library/windows/desktop/aa386945) method to specify the desired user name.
9.  The administrator requests a certificate on behalf of the user by calling the [**ISCrdEnr::enroll**](https://msdn.microsoft.com/library/windows/desktop/aa386564) method. The CA receiving the request will verify the administrator's signature on the PKCS \#7 (as well as verifying that the administrator's enrollment agent certificate was acceptable for enrolling on behalf of a user). The CA will also verify the user's signature on the PKCS \#10. If the request is successful, the resulting certificate is automatically placed on the smart card.
10. \[Optional\] The administrator can inspect the resulting certificate by calling the [**getEnrolledCertificateName**](https://msdn.microsoft.com/library/windows/desktop/aa386589) method.
11. The administrator removes the user's smart card and issues it to the user.
12. The administrator calls the [**resetUser**](https://msdn.microsoft.com/library/windows/desktop/aa386939) method, which clears the user's name and certificate from the Smart Card Enrollment control's memory, thereby preparing the control for the next user's certificate enrollment.
13. The administrator repeats steps 7 through 12 for the remaining users on whose behalf the administrator is enrolling for certificates. Optionally, the administrator can change the certificate template, CA, CSP or signing certificate prior to each certificate enrollment.

 

 




