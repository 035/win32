---
title: Storport Driver Miniport Routines
description: Storport Driver Miniport Routines
ms.assetid: 0ac56eac-15c8-4078-ae0b-b42b97a07607
keywords:
- Storport miniport drivers WDK , routines listed
ms.date: 05/31/2018
ms.topic: article
ms.author: windowssdkdev
ms.prod: windows
ms.technology: desktop
---

# Storport Driver Miniport Routines

## 

A miniport driver that works with the Storport driver must contain implementations of the routine descriptions listed in this section, and it must expose them through an [**HW\_INITIALIZATION\_DATA**](hw-initialization-data--storport-.md) structure during the miniport driver's initialization phase.

The Storport miniport driver routines are in most respects equivalent to their SCSI port counterparts (see [SCSI Miniport Driver Routines](scsi-miniport-driver-routines.md) for more information). However, there are important differences between the design of the SCSI port driver and that of the Storport driver, and these routines must accommodate those differences.

For instance, miniport drivers that work with the Storport driver must always be prepared to receive another I/O request after the [**HwStorStartIo**](hwstorstartio.md) routine has completed. A miniport driver that works with SCSI port is not required to do this. The SCSI port version does not receive a new I/O request until it explicitly signals the port driver, using the [**StorPortNotification**](storportnotification.md) function, that it is prepared to handle another request.

If the Storport version of the miniport driver cannot handle a request at the time it is submitted, it has a set of queue management functions, not available to the SCSI port version, that allow it to deal with the overload. Like the SCSI port version, the Storport version of the miniport driver completes the request with SRB\_STATUS\_BUSY, but unlike the SCSI port version, it can also mark the device queue as busy using the [**StorPortDeviceBusy**](storportdevicebusy.md) routine. Similar functions allow the miniport driver to pause and resume processing on an adapter-wide basis.

For more information about the support routines provided by the Storport driver, see [Storport Driver Support Routines](storport-driver-support-routines.md).

For more information about the Storport driver, see [Storage Port Drivers](https://msdn.microsoft.com/library/windows/hardware/ff566994).

This section describes the following miniport driver routines:

## In this section



| Topic                                                                               | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|-------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [*HW\_MESSAGE\_SIGNALED\_INTERRUPT\_ROUTINE*](hwmsinterruptroutine.md)<br/>  | The **HwMSInterruptRoutine** routine handles a message signaled interrupt (MSI).<br/>                                                                                                                                                                                                                                                                                                                                                                                         |
| [*HW\_ADAPTER\_CONTROL*](hwstoradaptercontrol.md)<br/>                       | A miniport driver's **HwStorAdapterControl** routine is called to perform synchronous operations to control the state or behavior of an adapter, such as stopping or restarting the HBA for power management.<br/>                                                                                                                                                                                                                                                            |
| [*HW\_BUILDIO*](hwstorbuildio.md)<br/>                                       | The **HwStorBuildIo** routine processes the SRB with unsynchronized access to shared system data structures before passing it to [**HwStorStartIo**](hwstorstartio.md).<br/>                                                                                                                                                                                                                                                                                                 |
| [*HW\_DPC\_ROUTINE*](hwstordpcroutine.md)<br/>                               | The **HwStorDpcRoutine** routine is a routine that is deferred for execution at DISPATCH IRQL by means of the deferred procedure call (DPC) mechanism. <br/>                                                                                                                                                                                                                                                                                                                  |
| [*HW\_FIND\_ADAPTER*](hwstorfindadapter.md)<br/>                             | The **HwStorFindAdapter** routine uses the supplied configuration to determine whether a specific HBA is supported and, if it is, to return configuration information about that adapter.<br/>                                                                                                                                                                                                                                                                                |
| [*HW\_INITIALIZE*](hwstorinitialize.md)<br/>                                 | The **HwStorInitialize** routine initializes the miniport driver after a system reboot or power failure occurs. It is called by StorPort after [**HwStorFindAdapter**](hwstorfindadapter.md) successfully returns. **HwStorInitialize** initializes the HBA and finds all devices that are of interest to the miniport driver.<br/>                                                                                                                                          |
| [*HW\_INTERRUPT*](hwstorinterrupt.md)<br/>                                   | The Storport driver calls the **HwStorInterrupt** routine after the HBA generates an interrupt request.<br/>                                                                                                                                                                                                                                                                                                                                                                  |
| [*HW\_PASSIVE\_INITIALIZE\_ROUTINE*](hwstorpassiveinitializeroutine.md)<br/> | The **HwStorPassiveInitializeRoutine** callback routine is called after the [**HwStorInitialize**](hwstorinitialize.md) routine when the current IRQL is at PASSIVE\_LEVEL. The **HwStorPassiveInitializeRoutine** callback is set by calling the [**StorPortEnablePassiveInitialization**](storportenablepassiveinitialization.md) routine. Initializing of the miniport's deferred procedure calls (DPCs) occurs in the **HwStorPassiveInitializeRoutine** callback.<br/> |
| [*HW\_RESET\_BUS*](hwstorresetbus.md)<br/>                                   | The **HwStorResetBus** routine is called by the port driver to clear error conditions.<br/>                                                                                                                                                                                                                                                                                                                                                                                   |
| [*HW\_STARTIO*](hwstorstartio.md)<br/>                                       | The Storport driver calls the **HwStorStartIo** routine one time for each incoming I/O request.<br/>                                                                                                                                                                                                                                                                                                                                                                          |
| [*HW\_STATE\_CHANGE*](hwstorstatechange.md)<br/>                             | A miniport-provided callback that is called after a notification from [**StorPortStateChangeDetected**](storportstatechangedetected.md) is processed.<br/>                                                                                                                                                                                                                                                                                                                   |
| [*HW\_TIMER*](hwstortimer.md)<br/>                                           | The **HwStorTimer** routine is called after the interval that is specified when the miniport driver called [**StorPortNotification**](storportnotification.md) with the **RequestTimerCall** *NotificationType* value.<br/>                                                                                                                                                                                                                                                  |
| [*HW\_TRACING\_ENABLED*](hwstortracingenabled.md)<br/>                       | The [**HwStorTracingEnabled**](hwstortracingenabled.md) callback routine enables the Storport to notify a miniport that event tracing is enabled. <br/>                                                                                                                                                                                                                                                                                                                      |
| [*HW\_UNIT\_CONTROL*](hwstorunitcontrol.md)<br/>                             | A miniport driver's **HwStorUnitControl** routine is called to perform synchronous operations to control the state of storage unit device. The miniport driver is notified to start a unit or handle a power state transition for a unit device.<br/>                                                                                                                                                                                                                         |
| [*HW\_WORKITEM*](hwstorworkitem.md)<br/>                                     | A miniport-provided callback function for processing a Storport work item request.<br/>                                                                                                                                                                                                                                                                                                                                                                                       |
| [**STORPORT\_TELEMETRY\_EVENT**](storport-telemetry-event.md)<br/>           | The **STORPORT\_TELEMETRY\_EVENT** structure describes the miniport telemetry data payload.<br/>                                                                                                                                                                                                                                                                                                                                                                              |
| [**StorPortLogTelemetry**](storportlogtelemetry.md)<br/>                     | The **StorPortLogTelemetry** routine logs a miniport telemetry event to help diagnose or collect any useful information. The miniport can log eight general purpose name-value pairs and a buffer that has maximum length of 4KB, as well as several event related fields that are defined in structure [**STORPORT\_TELEMETRY\_EVENT**](storport-telemetry-event.md).<br/>                                                                                                  |



 

 

 

[Send comments about this topic to Microsoft](mailto:wsddocfb@microsoft.com?subject=Documentation%20feedback%20%5Bstorage\storage%5D:%20Storport%20Driver%20Miniport%20Routines%20%20RELEASE:%20%283/29/2018%29&body=%0A%0APRIVACY%20STATEMENT%0A%0AWe%20use%20your%20feedback%20to%20improve%20the%20documentation.%20We%20don't%20use%20your%20email%20address%20for%20any%20other%20purpose,%20and%20we'll%20remove%20your%20email%20address%20from%20our%20system%20after%20the%20issue%20that%20you're%20reporting%20is%20fixed.%20While%20we're%20working%20to%20fix%20this%20issue,%20we%20might%20send%20you%20an%20email%20message%20to%20ask%20for%20more%20info.%20Later,%20we%20might%20also%20send%20you%20an%20email%20message%20to%20let%20you%20know%20that%20we've%20addressed%20your%20feedback.%0A%0AFor%20more%20info%20about%20Microsoft's%20privacy%20policy,%20see%20http://privacy.microsoft.com/default.aspx. "Send comments about this topic to Microsoft")





