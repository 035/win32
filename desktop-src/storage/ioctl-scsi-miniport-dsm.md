---
title: IOCTL\_SCSI\_MINIPORT\_DSM control code
description: A Data Set Management (DSM) notification is transferred to a miniport driver in a IOCTL\_SCSI\_MINIPORT\_DSM control code request.
ms.assetid: CA91B623-F926-453D-A348-92655875D801
keywords:
- IOCTL_SCSI_MINIPORT_DSM control code Storage Devices
topic_type:
- apiref
api_name:
- IOCTL_SCSI_MINIPORT_DSM
api_location:
- scsi.h
api_type:
- HeaderDef
ms.technology: desktop
ms.prod: windows
ms.author: windowssdkdev
ms.topic: article
ms.date: 05/31/2018
---

# IOCTL\_SCSI\_MINIPORT\_DSM control code

A Data Set Management (DSM) notification is transferred to a miniport driver in a **IOCTL\_SCSI\_MINIPORT\_DSM** control code request. The **IOCTL\_SCSI\_MINIPORT\_DSM** request is a sub-IOCTL of [**IOCTL\_SCSI\_MINIPORT**](ioctl-scsi-miniport.md). This IOCTL generated by StorPort in response to a DSM action, then sent to the miniport as a [**STORAGE\_REQUEST\_BLOCK**](storage-request-block.md) (SRB) with a function type of SRB\_FUNCTION\_IO\_CONTROL. The input and output data is contained in the SRB data block.

> [!Note]  
> The SCSI port driver and SCSI miniport driver models may be altered or unavailable in the future. Instead, we recommend using the [Storport driver](https://msdn.microsoft.com/windows/hardware/drivers/storage/storport-driver) and [Storport miniport](https://msdn.microsoft.com/windows/hardware/drivers/storage/storport-miniport-drivers) driver models.

 

## Input Buffer

The buffer specified in the **DataBuffer** member of the SRB must contain an [**SRB\_IO\_CONTROL**](srb-io-control.md) structure and a **DSM\_NOTIFICATION\_REQUEST\_BLOCK** structure.

## Input Buffer Length

**DataTransferLength** indicates the size, in bytes, of the buffer, which must be at least **sizeof** (SRB\_IO\_CONTROL) + **sizeof**(DSM\_NOTIFICATION\_REQUEST\_BLOCK), with additional storage for the **MP\_DEVICE\_DATA\_SET\_RANGE** structures included.

## Output Buffer

An updated [**SRB\_IO\_CONTROL**](srb-io-control.md) structure is returned to the data buffer in the SRB. The **SrbStatus** contains the result of the miniport's processing of the request.

## Output Buffer Length

The length of an [**SRB\_IO\_CONTROL**](srb-io-control.md) structure.

## Status block

The resulting status of the function request is set in the **SrbStatus** member of [**SRB\_IO\_CONTROL**](srb-io-control.md). The following are the DSM disk IOCTL status codes.



| SRB Status                    | Description                                 |
|-------------------------------|---------------------------------------------|
| SRB\_STATUS\_SUCCESS          | The request completed successfully.         |
| SRB\_STATUS\_INVALID\_REQUEST | The request contains an invalid buffer size |



 

## Remarks

**DSM\_NOTIFICATION\_REQUEST\_BLOCK**

A **DSM\_NOTIFICATION\_REQUEST\_BLOCK** structure immediately follows the [**SRB\_IO\_CONTROL**](srb-io-control.md) structure in the data buffer of the SRB. **DSM\_NOTIFICATION\_REQUEST\_BLOCK** is defined in ntddscsi.h as the following.


```
typedef struct _DSM_NOTIFICATION_REQUEST_BLOCK {
    ULONG   Version;
    ULONG   Size;
    ULONG   NotifyFLags;
    ULONG   DataSetProfile;
    ULONG   Reserved[3];
    ULONG   DataSetRangesCount;
    MP_DEVICE_DATA_SET_RANGE DataSetRanges[ANYSIZE_ARRAY];
} DSM_NOTIFICATION_REQUEST_BLOCK, *PDSM_NOTIFICATION_REQUEST_BLOCK;
```



<dl> <dt>

<span id="Version"></span><span id="version"></span><span id="VERSION"></span>Version
</dt> <dd>

The version of the structure. Set to MINIPORT\_DSM\_NOTIFICATION\_VERSION.

</dd> <dt>

<span id="Size"></span><span id="size"></span><span id="SIZE"></span>Size
</dt> <dd>

The size of the structure. Set to **sizeof**(DSM\_NOTIFICATION\_REQUEST\_BLOCK).

</dd> <dt>

<span id="NotifyFlags"></span><span id="notifyflags"></span><span id="NOTIFYFLAGS"></span>NotifyFlags
</dt> <dd>

The notification flag. Indicates if the included LBA range is used as part of the file defined by the profile type.

<dl> <dt>

<span id="DEVICE_DSM_NOTIFY_FLAG_BEGIN"></span><span id="device_dsm_notify_flag_begin"></span>DEVICE\_DSM\_NOTIFY\_FLAG\_BEGIN
</dt> <dd>

The included LBA range is used as part of the file defined by the profile type.

</dd> <dt>

<span id="DEVICE_DSM_NOTIFY_FLAG_END"></span><span id="device_dsm_notify_flag_end"></span>DEVICE\_DSM\_NOTIFY\_FLAG\_END
</dt> <dd>

The included LBA range is not used as part of the file defined by the profile type.

</dd> </dl> </dd> <dt>

<span id="DataSetProfile"></span><span id="datasetprofile"></span><span id="DATASETPROFILE"></span>DataSetProfile
</dt> <dd>

The profile type. Specifies the expected access pattern to the data set.

<dl> <dt>

<span id="MINIPORT_DSM_PROFILE_UNKNOWN"></span><span id="miniport_dsm_profile_unknown"></span>MINIPORT\_DSM\_PROFILE\_UNKNOWN
</dt> <dd>

Unknown access pattern.

</dd> <dt>

<span id="MINIPORT_DSM_PROFILE_PAGE_FILE"></span><span id="miniport_dsm_profile_page_file"></span>MINIPORT\_DSM\_PROFILE\_PAGE\_FILE
</dt> <dd>

Page file access.

</dd> <dt>

<span id="MINIPORT_DSM_PROFILE_HIBERNATION_FILE"></span><span id="miniport_dsm_profile_hibernation_file"></span>MINIPORT\_DSM\_PROFILE\_HIBERNATION\_FILE
</dt> <dd>

Hibernation file access.

</dd> <dt>

<span id="MINIPORT_DSM_PROFILE_CRASHDUMP_FILE"></span><span id="miniport_dsm_profile_crashdump_file"></span>MINIPORT\_DSM\_PROFILE\_CRASHDUMP\_FILE
</dt> <dd>

Crash dump file access.

</dd> </dl> </dd> <dt>

<span id="Reserved_3_"></span><span id="reserved_3_"></span><span id="RESERVED_3_"></span>Reserved\[3\]
</dt> <dd>

Reserved. Set to 0.

</dd> <dt>

<span id="DataSetRangesCount"></span><span id="datasetrangescount"></span><span id="DATASETRANGESCOUNT"></span>DataSetRangesCount
</dt> <dd>

The count of **MP\_DEVICE\_DATA\_SET\_RANGE** structures in **DataSetRanges**.

</dd> <dt>

<span id="DataSetRanges"></span><span id="datasetranges"></span><span id="DATASETRANGES"></span>DataSetRanges
</dt> <dd>

An array of **MP\_DEVICE\_DATA\_SET\_RANGE** structures containing LBA ranges for the profile.

</dd> </dl>

**MP\_DEVICE\_DATA\_SET\_RANGE**

The LBA ranges are included in the in **DataSetRanges** member of **DSM\_NOTIFICATION\_REQUEST\_BLOCK** as an array of **MP\_DEVICE\_DATA\_SET\_RANGE** structures. **MP\_DEVICE\_DATA\_SET\_RANGE** is defined in ntddscsi.h as the following.


```
rypedef struct _MP_DEVICE_DATA_SET_RANGE {
    LONGLONG    StartingOffset;
    ULONGLONG   LengthInBytes;
} MP_DEVICE_DATA_SET_RANGE, *PMP_DEVICE_DATA_SET_RANGE;
```



<dl> <dt>

<span id="StartingOffset"></span><span id="startingoffset"></span><span id="STARTINGOFFSET"></span>StartingOffset
</dt> <dd>

The starting offset, in bytes, of the data set range. The offset value must be block aligned.

</dd> <dt>

<span id="LengthInBytes"></span><span id="lengthinbytes"></span><span id="LENGTHINBYTES"></span>LengthInBytes
</dt> <dd>

The length, in bytes, of the data set range. The length value must be block aligned.

</dd> </dl>

The **DSM\_NOTIFICATION\_REQUEST\_BLOCK** structure is located after the [**SRB\_IO\_CONTROL**](srb-io-control.md) structure in the **DataBuffer** of the SRB.

The [**SRB\_IO\_CONTROL**](srb-io-control.md) structure for this IOCTL contains IOCTL\_MINIPORT\_SIGNATURE\_DSM\_NOTIFICATION in its **Signature** member and **IOCTL\_SCSI\_MINIPORT\_DSM** in the **ControlCode** member.

## Requirements



|                    |                                                                                                                      |
|--------------------|----------------------------------------------------------------------------------------------------------------------|
| Version<br/> | Available starting with Windows 8.1.<br/>                                                                      |
| Header<br/>  | <dl> <dt>Scsi.h (include Ntddscsi.h or Storport.h)</dt> </dl> |



## See also

<dl> <dt>

[**IOCTL\_SCSI\_MINIPORT**](ioctl-scsi-miniport.md)
</dt> <dt>

[**SRB\_IO\_CONTROL**](srb-io-control.md)
</dt> <dt>

[**STORAGE\_REQUEST\_BLOCK**](storage-request-block.md)
</dt> </dl>

 

 

[Send comments about this topic to Microsoft](mailto:wsddocfb@microsoft.com?subject=Documentation%20feedback%20%5Bstorage\storage%5D:%20IOCTL_SCSI_MINIPORT_DSM%20control%20code%20%20RELEASE:%20%283/29/2018%29&body=%0A%0APRIVACY%20STATEMENT%0A%0AWe%20use%20your%20feedback%20to%20improve%20the%20documentation.%20We%20don't%20use%20your%20email%20address%20for%20any%20other%20purpose,%20and%20we'll%20remove%20your%20email%20address%20from%20our%20system%20after%20the%20issue%20that%20you're%20reporting%20is%20fixed.%20While%20we're%20working%20to%20fix%20this%20issue,%20we%20might%20send%20you%20an%20email%20message%20to%20ask%20for%20more%20info.%20Later,%20we%20might%20also%20send%20you%20an%20email%20message%20to%20let%20you%20know%20that%20we've%20addressed%20your%20feedback.%0A%0AFor%20more%20info%20about%20Microsoft's%20privacy%20policy,%20see%20http://privacy.microsoft.com/default.aspx. "Send comments about this topic to Microsoft")






