---
title: Generate Dump File from a Process Snapshot
description: You can generate a process snapshot dump file by using the MiniDumpWriteDump function provided by the Debug help library.
ms.assetid: 22AB09C4-D512-41AF-9499-FBED25D84B7B
ms.date: 05/31/2018
ms.topic: article
ms.author: windowssdkdev
ms.prod: windows
ms.technology: desktop
---

# Generate Dump File from a Process Snapshot

\[Some information relates to pre-released product which may be substantially modified before it's commercially released. Microsoft makes no warranties, express or implied, with respect to the information provided here.\]

You can generate a process snapshot dump file by using the [**MiniDumpWriteDump**](https://msdn.microsoft.com/library/windows/desktop/ms680360) function provided by the Debug help library. The contents of a dump file are mostly identical to a dump generated by calling [**MiniDumpWriteDump**](https://msdn.microsoft.com/library/windows/desktop/ms680360) on a live process. Specify the type of information the function dumps by using the [**MINIDUMP\_TYPE**](https://msdn.microsoft.com/library/windows/desktop/ms680519) enumeration.

To save the process snapshot, first get a process snapshot by using the [**PssCaptureSnapshot**](/windows/previous-versions/processsnapshot/nf-processsnapshot-psscapturesnapshot?branch=master) function.

Specify the process snapshot handle and process ID of the result to [**MiniDumpWriteDump**](https://msdn.microsoft.com/library/windows/desktop/ms680360).

The following example creates a constant that contains capture flag values. For more information, see the [**PSS\_CAPTURE\_FLAGS**](/windows/previous-versions/processsnapshot/ne-processsnapshot-pss_capture_flags?branch=master) enumeration.


```C++
DWORD CaptureFlags = (DWORD)PSS_CAPTURE_VA_CLONE
                            | PSS_CAPTURE_HANDLES
                            | PSS_CAPTURE_HANDLE_NAME_INFORMATION
                            | PSS_CAPTURE_HANDLE_BASIC_INFORMATION
                            | PSS_CAPTURE_HANDLE_TYPE_SPECIFIC_INFORMATION
                            | PSS_CAPTURE_HANDLE_TRACE
                            | PSS_CAPTURE_THREADS
                            | PSS_CAPTURE_THREAD_CONTEXT
                            | PSS_CAPTURE_THREAD_CONTEXT_EXTENDED
                            | PSS_CREATE_BREAKAWAY
                            | PSS_CREATE_BREAKAWAY_OPTIONAL
                            | PSS_CREATE_USE_VM_ALLOCATIONS
                            | PSS_CREATE_RELEASE_SECTION;
```



The following example captures a process snapshot for the process handle specified by the *ProcessHandle* variable.


```C++
HANDLE SnapshotHandle;
DWORD dwResultCode = PssCaptureSnapshot (ProcessHandle,
                                         CaptureFlags,
                                         CONTEXT_ALL,
                                         &amp;SnapshotHandle);

// Error handling omitted. Check that dwResultCode is ERROR_SUCCESS.
```



To tell the [**MiniDumpWriteDump**](https://msdn.microsoft.com/library/windows/desktop/ms680360) function that the dump should be generated based on snapshot handle **SnapshotHandle**, respond to the **IsProcessSnapshotCallback** message from the **MiniDumpWriteDump** callback. The numeric value of **IsProcessSnapshotCallback** is 16.

A callback for [**MiniDumpWriteDump**](https://msdn.microsoft.com/library/windows/desktop/ms680360) can be set up as in the following example:


```C++
ZeroMemory (&amp;CallbackInfo, sizeof (MINIDUMP_CALLBACK_INFORMATION));
CallbackInfo.CallbackRoutine = MyMiniDumpWriteDumpCallback;
CallbackInfo.CallbackParam = NULL;
```



The following example shows a minimal callback implementation to respond with the snapshot handle.


```C++
BOOL CALLBACK MyMiniDumpWriteDumpCallback(
  __in     PVOID CallbackParam,
  __in     const PMINIDUMP_CALLBACK_INPUT CallbackInput,
  __inout  PMINIDUMP_CALLBACK_OUTPUT CallbackOutput
)
{
    switch (CallbackInput->CallbackType)
    {
        case 16: // IsProcessSnapshotCallback
            CallbackOutput->Status = S_FALSE;
            break;
    }
    return TRUE;
}
```



Case 16 of the switch sets the output status to S\_FALSE. This informs [**MiniDumpWriteDump**](https://msdn.microsoft.com/library/windows/desktop/ms680360) that the handle is a PSS snapshot handle, not a process handle. For more information about the **IsProcessSnapshotCallback** value, see the [**MINIDUMP\_CALLBACK\_TYPE**](https://msdn.microsoft.com/library/windows/desktop/ms680364) enumeration.

The following example dumps the captured process snapshot stored at *SnapshotHandle*.


```C++
BOOL Success MiniDumpWriteDump ((HANDLE) SnapshotHandle,
                            ProcessId,
                            FileHandle,
                            DumpType,
                            NULL,
                            NULL,
                            &amp;CallbackInfo);
```



> [!Note]  
> On failure, [**MiniDumpWriteDump**](https://msdn.microsoft.com/library/windows/desktop/ms680360) sets the last error to an **HRESULT**.

 

The function saves the results to the file specified by the *FileHandle* variable. The [**MINIDUMP\_TYPE**](https://msdn.microsoft.com/library/windows/desktop/ms680519) structure specified by the *DumpType* variable determines what process snapshot information the function saves.

After this function saves the process snapshot information, use the [**PssFreeSnapshot**](/windows/previous-versions/processsnapshot/nf-processsnapshot-pssfreesnapshot?branch=master) function to release the resource, as in the following example:


```C++
PssFreeSnapshot (GetCurrentProcess(), SnapshotHandle);
```



For more information, see the [**MiniDumpWriteDump**](https://msdn.microsoft.com/library/windows/desktop/ms680360) function reference and the [**MINIDUMP\_CALLBACK\_TYPE**](https://msdn.microsoft.com/library/windows/desktop/ms680364) enumeration.

## Related topics

<dl> <dt>

[**PSS\_CAPTURE\_FLAGS**](/windows/previous-versions/processsnapshot/ne-processsnapshot-pss_capture_flags?branch=master)
</dt> <dt>

[**MINIDUMP\_CALLBACK\_TYPE**](https://msdn.microsoft.com/library/windows/desktop/ms680364)
</dt> <dt>

[**MINIDUMP\_TYPE**](https://msdn.microsoft.com/library/windows/desktop/ms680519)
</dt> <dt>

[**MiniDumpWriteDump**](https://msdn.microsoft.com/library/windows/desktop/ms680360)
</dt> <dt>

[**PssCaptureSnapshot**](/windows/previous-versions/processsnapshot/nf-processsnapshot-psscapturesnapshot?branch=master)
</dt> <dt>

[**PssFreeSnapshot**](/windows/previous-versions/processsnapshot/nf-processsnapshot-pssfreesnapshot?branch=master)
</dt> </dl>

 

 




