---
Description: A printer interface DLLs DrvDocumentEvent function can handle certain events associated with printing a document.
ms.assetid: 09229774-14db-448b-bd49-2d39a848c9a6
title: DrvDocumentEvent function
ms.date: 05/31/2018
ms.topic: article
ms.author: windowssdkdev
ms.prod: windows
ms.technology: desktop
---

# DrvDocumentEvent function

A printer interface DLL's **DrvDocumentEvent** function can handle certain events associated with printing a document.

## Syntax


```C++
int DrvDocumentEvent(
        HANDLE hPrinter,
        HDC    hdc,
        int    iEsc,
        ULONG  cbIn,
  _In_  PVOID  pvIn,
        ULONG  cbOut,
  _Out_ PVOID  pvOut
);
```



## Parameters

<dl> <dt>

*hPrinter* 
</dt> <dd>

Caller-supplied printer handle.

</dd> <dt>

*hdc* 
</dt> <dd>

Caller-supplied device context handle, generated by a **CreateDC** (described in the Windows SDK documentation) call. This is zero if *iEsc* is set to DOCUMENTEVENT\_CREATEDCPRE. For restrictions on printing from a 32-bit application on a 64-bit version of Windows, see the following Remarks section.

</dd> <dt>

*iEsc* 
</dt> <dd>

Caller-supplied escape code identifying the event to be handled. This parameter can be one of the following integer constants. See the Windows SDK documentation for descriptions of the functions listed in the Event column.

For restrictions on printing from a 32-bit application on a 64-bit version of Windows, see the following Remarks section.



| **iEsc** Constant                                                                       | Event                                                                                                                                                                                                                                                                                                             |
|-----------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| DOCUMENTEVENT\_ABORTDOC<br/>                                                      | GDI is about to process a call to its **AbortDoc** function.<br/>                                                                                                                                                                                                                                           |
| DOCUMENTEVENT\_CREATEDCPOST<br/>                                                  | GDI has just processed a call to its **CreateDC** or **CreateIC** function.<br/> This escape code should not be used unless there has been a previous call to **DrvDocumentEvent** with *iEsc* set to DOCUMENTEVENT\_CREATEDCPRE.<br/>                                                                |
| DOCUMENTEVENT\_CREATEDCPRE<br/>                                                   | GDI is about to process a call to its **CreateDC** or **CreateIC** function.<br/>                                                                                                                                                                                                                           |
| DOCUMENTEVENT\_DELETEDC<br/>                                                      | GDI is about to process a call to its **DeleteDC** function.<br/>                                                                                                                                                                                                                                           |
| DOCUMENTEVENT\_ENDDOCPOST<br/>                                                    | GDI has just processed a call to its **EndDoc** function.<br/>                                                                                                                                                                                                                                              |
| DOCUMENTEVENT\_ENDDOCPRE <br/> or<br/> DOCUMENTEVENT\_ENDDOC<br/>     | GDI is about to process a call to its **EndDoc** function.<br/>                                                                                                                                                                                                                                             |
| DOCUMENTEVENT\_ENDPAGE<br/>                                                       | GDI is about to process a call to its **EndPage** function.<br/>                                                                                                                                                                                                                                            |
| DOCUMENTEVENT\_ESCAPE<br/>                                                        | GDI is about to process a call to its **ExtEscape** function.<br/>                                                                                                                                                                                                                                          |
| DOCUMENTEVENT\_QUERYFILTER<br/>                                                   | The DOCUMENTEVENT\_QUERYFILTER event represents an opportunity for the spooler to query the driver for a list of the DOCUMENTEVENT\_*XXX* events to which the driver will respond. This event is issued just prior to a call to **DrvDocumentEvent** that passes the DOCUMENTEVENT\_CREATEDCPRE event.<br/> |
| DOCUMENTEVENT\_RESETDCPOST<br/>                                                   | GDI has just processed a call to its **ResetDC** function.<br/> This escape code should not be used unless there has been a previous call to **DrvDocumentEvent** with *iEsc* set to DOCUMENTEVENT\_RESETDCPRE.<br/>                                                                                  |
| DOCUMENTEVENT\_RESETDCPRE<br/>                                                    | GDI is about to process a call to its **ResetDC** function.<br/>                                                                                                                                                                                                                                            |
| DOCUMENTEVENT\_STARTDOCPOST<br/>                                                  | GDI has just processed a call to its **StartDoc** function.<br/>                                                                                                                                                                                                                                            |
| DOCUMENTEVENT\_STARTDOCPRE <br/> or<br/> DOCUMENTEVENT\_STARTDOC<br/> | GDI is about to process a call to its **StartDoc** function.<br/>                                                                                                                                                                                                                                           |
| DOCUMENTEVENT\_STARTPAGE<br/>                                                     | GDI is about to process a call to its **StartPage** function.<br/>                                                                                                                                                                                                                                          |



 

</dd> <dt>

*cbIn* 
</dt> <dd>

Caller-supplied size, in bytes, of the buffer pointed to by *pvIn*.

</dd> <dt>

*pvIn* \[in\]
</dt> <dd>

Caller-supplied pointer, the use of which is dependent on the value supplied for *iEsc*, as follows:



| *iEsc* Constant                                                                         | *pvIn* Contents                                                                                                                                                                                                                                     |
|-----------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| DOCUMENTEVENT\_ABORTDOC<br/>                                                      | Not used.<br/>                                                                                                                                                                                                                                |
| DOCUMENTEVENT\_CREATEDCPOST<br/>                                                  | *pvIn* contains the address of a pointer to the [**DEVMODEW**](display.devmodew) structure specified in the *pvOut* parameter in a previous call to this function, for which the *iEsc* parameter was set to DOCUMENTEVENT\_CREATEDCPRE.<br/> |
| DOCUMENTEVENT\_CREATEDCPRE<br/>                                                   | *pvIn* points to a [**DOCEVENT\_CREATEDCPRE**](docevent-createdcpre.md) structure.<br/>                                                                                                                                                      |
| DOCUMENTEVENT\_DELETEDC<br/>                                                      | Not used.<br/>                                                                                                                                                                                                                                |
| DOCUMENTEVENT\_ENDDOCPOST<br/>                                                    | Not used.<br/>                                                                                                                                                                                                                                |
| DOCUMENTEVENT\_ENDDOCPRE <br/> or<br/> DOCUMENTEVENT\_ENDDOC<br/>     | Not used.<br/>                                                                                                                                                                                                                                |
| DOCUMENTEVENT\_ENDPAGE<br/>                                                       | Not used.<br/>                                                                                                                                                                                                                                |
| DOCUMENTEVENT\_ESCAPE<br/>                                                        | *pvIn* points to a [**DOCEVENT\_ESCAPE**](docevent-escape.md) structure.<br/>                                                                                                                                                                |
| DOCUMENTEVENT\_QUERYFILTER<br/>                                                   | Same as for DOCUMENTEVENT\_CREATEDCPRE.<br/>                                                                                                                                                                                                  |
| DOCUMENTEVENT\_RESETDCPOST<br/>                                                   | *pvIn* contains the address of a pointer to the [**DEVMODEW**](display.devmodew) structure specified in the *pvOut* parameter in a previous call to this function, for which the *iEsc* parameter was set to DOCUMENTEVENT\_RESETDCPRE.<br/>  |
| DOCUMENTEVENT\_RESETDCPRE<br/>                                                    | *pvIn* contains the address of a pointer to the [**DEVMODEW**](display.devmodew) structure supplied by the caller of **ResetDC** (described in the Windows SDK documentation).<br/>                                                           |
| DOCUMENTEVENT\_STARTDOCPOST<br/>                                                  | *pvIn* points to a LONG that specifies the print job identifier returned by **StartDoc** (described in the Windows SDK documentation).<br/>                                                                                                   |
| DOCUMENTEVENT\_STARTDOCPRE <br/> or<br/> DOCUMENTEVENT\_STARTDOC<br/> | *pvIn* contains the address of a pointer to a DOCINFO structure supplied by the caller of **StartDoc** (both described in the Windows SDK documentation). <br/>                                                                               |
| DOCUMENTEVENT\_STARTPAGE<br/>                                                     | Not used.<br/>                                                                                                                                                                                                                                |



 

</dd> <dt>

*cbOut* 
</dt> <dd>

<dl> <dt>

<span id="If_iEsc_is_DOCUMENTEVENT_ESCAPE_"></span><span id="if_iesc_is_documentevent_escape_"></span><span id="IF_IESC_IS_DOCUMENTEVENT_ESCAPE_"></span>If *iEsc* is DOCUMENTEVENT\_ESCAPE:
</dt> <dd>

Function-supplied value that is used as the *cbOutput* parameter for **ExtEscape**.

</dd> <dt>

<span id="If_iEsc_is_DOCUMENTEVENT_QUERYFILTER_"></span><span id="if_iesc_is_documentevent_queryfilter_"></span><span id="IF_IESC_IS_DOCUMENTEVENT_QUERYFILTER_"></span>If *iEsc* is DOCUMENTEVENT\_QUERYFILTER:
</dt> <dd>

Caller-supplied size, in bytes, of the buffer pointer to by *pvOut*.

</dd> <dt>

<span id="For_all_other_iEsc_values_"></span><span id="for_all_other_iesc_values_"></span><span id="FOR_ALL_OTHER_IESC_VALUES_"></span>For all other *iEsc* values:
</dt> <dd>

Not used.

</dd> </dl> </dd> <dt>

*pvOut* \[out\]
</dt> <dd>

Function-supplied pointer to an output buffer, the use of which is dependent on the value supplied for *iEsc*, as follows. **CreateDC**, **ExtEscape**, and **ResetDC** are described in the Windows SDK documentation.



| *iEsc* Constant                       | *pvOut* Contents                                                                                                                                                                          |
|---------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| DOCUMENTEVENT\_CREATEDCPRE<br/> | Pointer to a driver-supplied DEVMODEW structure, which GDI uses instead of the one supplied by the **CreateDC** caller. (If **NULL**, GDI uses the caller-supplied structure.)<br/> |
| DOCUMENTEVENT\_ESCAPE<br/>      | Buffer pointer that is used as the *lpszOutData* parameter for **ExtEscape**.<br/>                                                                                                  |
| DOCUMENTEVENT\_QUERYFILTER<br/> | Caller-supplied pointer to buffer containing a [**DOCEVENT\_FILTER**](docevent-filter.md) structure.<br/>                                                                          |
| DOCUMENTEVENT\_RESETDCPRE<br/>  | Pointer to a driver-supplied DEVMODEW structure, which GDI uses instead of the one supplied by the **ResetDC** caller. (If **NULL**, GDI uses the caller-supplied structure.)<br/>  |
| All other *iEsc* values<br/>    | Not used.<br/>                                                                                                                                                                      |



 

</dd> </dl>

## Return value

The function's return value is dependent on the escape supplied for *iEsc*. For some escape codes, the return value is not used (see the second list of values). If the function supplies a return value, it must be one of the following:



| Return code                                                                                               | Description                                                                                  |
|-----------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------|
| <dl> <dt>**DOCUMENTEVENT\_FAILURE**</dt> </dl>     | The driver supports the escape code identified by *iEsc*, but a failure occurred.<br/> |
| <dl> <dt>**DOCUMENTEVENT\_SUCCESS**</dt> </dl>     | The driver successfully handled the escape code identified by *iEsc*.<br/>             |
| <dl> <dt>**DOCUMENTEVENT\_UNSUPPORTED**</dt> </dl> | The driver does not support the escape code identified by *iEsc*.<br/>                 |



 

## Remarks

A [printer interface DLL](print.printer_interface_dll) can optionally provide a **DrvDocumentEvent** function to perform preprocessing or postprocessing of GDI calls associated with rendering a document. Calls to the **DrvDocumentEvent** function are made from the user-mode GDI client, when an application makes calls into the GDI client.

For an *iEsc* value of DOCUMENTEVENT\_QUERYFILTER, the spooler can interpret a DOCUMENTEVENT\_SUCCESS value returned by **DrvDocumentEvent** in two ways, depending on whether the driver modified certain members of the [**DOCEVENT\_FILTER**](docevent-filter.md) structure. (The *pvOut* parameter points to this structure.) When the spooler allocates memory for a structure of this type, it initializes two members of this structure, **cElementsReturned** and **cElementsNeeded**, to known values. After **DrvDocumentEvent** returns, the spooler determines whether the values of these members have changed, and uses that information to interpret the **DrvDocumentEvent** return value. The following table summarizes this situation.



Return Value

Status of cElementsReturned,

Meaning

cElementsNeeded

DOCUMENTEVENT\_SUCCESS<br/>

Driver made no change to either member.<br/>

The spooler interprets this return value as equivalent to DOCUMENTEVENT\_UNSUPPORTED.<br/> The spooler is unable to retrieve the event filter from the driver, so it persists in calling **DrvDocumentEvent** for all events.<br/>

DOCUMENTEVENT\_SUCCESS<br/>

Driver wrote to one or both members.<br/>

The spooler accepts this return value without interpretation. If the driver wrote to only one of **cElementsNeeded** and **cElementsReturned**, the spooler considers the unchanged member to have a value of zero.<br/> The spooler filters out all events listed in the **aDocEventCall** member of [**DOCEVENT\_FILTER**](docevent-filter.md).<br/>

DOCUMENTEVENT\_UNSUPPORTED<br/>

Not applicable<br/>

The driver does not support DOCUMENTEVENT\_QUERYFILTER.<br/> The spooler is unable to retrieve the event filter from the driver, so it persists in calling **DrvDocumentEvent** for all events.<br/>

DOCUMENTEVENT\_FAILURE<br/>

Not applicable<br/>

The driver supports DOCUMENTEVENT\_QUERYFILTER, but encountered an internal error.<br/> The spooler is unable to retrieve the event filter from the driver, so it persists in calling **DrvDocumentEvent** for all events.<br/>



 

If the escape code name has no suffix or is suffixed with PRE, the GDI client calls **DrvDocumentEvent** just prior to calling the kernel-mode GDI rendering engine. If the escape code name is suffixed with POST, the GDI client calls **DrvDocumentEvent** just after the kernel-mode GDI rendering engine returns.

If the escape code supplied in the *iEsc* parameter is DOCUMENTEVENT\_CREATEDCPRE, the following rules apply:

-   If the job is being sent directly to the printer without spooling, *pvIn* --&gt; pszDevice points to the printer name. (See the [**DOCEVENT\_CREATEDCPRE**](docevent-createdcpre.md) structure for more information.)

-   If the job is being spooled, *pvIn* --&gt; pszDevice points to the printer port name.

The **DrvDocumentEvent** function executes in the context of the user-mode caller of the GDI client function. When EMF spooling is disabled, the function can display a user interface. For example, the **DrvDocumentEvent** function for a FAX driver might display a dialog box to the user before GDI's **StartDoc** function (described in the Microsoft Windows SDK documentation) is processed.

> [!Note]  
> The following restrictions apply when running a 32-bit application on a 64-bit version of Windows. The only GDI function that **DrvDocumentEvent** should call is **ExtEscape**, and only private escapes should be used. **DrvDocumentEvent** calls to other GDI functions may produce undefined behavior.

 

## Requirements



|                            |                                                                                                            |
|----------------------------|------------------------------------------------------------------------------------------------------------|
| Target platform<br/> | <dl> <dt>Desktop</dt> </dl>                         |
| Header<br/>          | <dl> <dt>Winddiui.h (include Winddiui.h)</dt> </dl> |



## See also

<dl> <dt>

[**DOCEVENT\_FILTER**](docevent-filter.md)
</dt> <dt>

[**DOCEVENT\_CREATEDCPRE**](docevent-createdcpre.md)
</dt> <dt>

[**DOCEVENT\_ESCAPE**](docevent-escape.md)
</dt> </dl>

 

 

[Send comments about this topic to Microsoft](mailto:wsddocfb@microsoft.com?subject=Documentation%20feedback%20%5Bprint\print%5D:%20DrvDocumentEvent%20function%20%20RELEASE:%20%285/12/2018%29&body=%0A%0APRIVACY%20STATEMENT%0A%0AWe%20use%20your%20feedback%20to%20improve%20the%20documentation.%20We%20don't%20use%20your%20email%20address%20for%20any%20other%20purpose,%20and%20we'll%20remove%20your%20email%20address%20from%20our%20system%20after%20the%20issue%20that%20you're%20reporting%20is%20fixed.%20While%20we're%20working%20to%20fix%20this%20issue,%20we%20might%20send%20you%20an%20email%20message%20to%20ask%20for%20more%20info.%20Later,%20we%20might%20also%20send%20you%20an%20email%20message%20to%20let%20you%20know%20that%20we've%20addressed%20your%20feedback.%0A%0AFor%20more%20info%20about%20Microsoft's%20privacy%20policy,%20see%20http://privacy.microsoft.com/en-us/default.aspx. "Send comments about this topic to Microsoft")





